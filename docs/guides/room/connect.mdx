---
title: Connection and callbacks
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

A room is the main construct in dTelecom. Upon successful connection, you're provided a room object to interact with. The two key properties on a room object are the **LocalParticipant** object, representing the current user, and **RemoteParticipants**, an array of other users in the room.

You can also listen for room events. Your callbacks will be invoked whenever various states of the room change.

For events happening to a specific participant, they will also be fired on the appropriate `RemoteParticipant` or `LocalParticipant` object.

## Connecting to a room

Connecting to a room requires two parameters: a `url` and a `token`.

The `url` is a WebSocket URL returned by `token.getWsUrl(clientIp)` on your server. Unlike centralized services, dTelecom does not use a fixed server URL â€” the URL is dynamically resolved from the Solana node registry based on the client's IP for optimal latency. See [Architecture](/guides/architecture) for details.

The `token` is an access token representing the particular local participant, signed with your Ed25519 API secret. See [Access Tokens](/guides/access-tokens).

<Tabs
  defaultValue="react"
  groupId="client-sdk"
  values={[
    {label: 'React', value: 'react'},
    {label: 'Browser', value: 'typescript'},
  ]}>
  <TabItem value="react">

```tsx title="React"
import { LiveKitRoom, VideoConference } from '@dtelecom/components-react';
import '@dtelecom/components-styles';

// token and wsUrl are fetched from your server (see Getting Started guide)
function MyApp({ token, wsUrl }: { token: string; wsUrl: string }) {
  return (
    <LiveKitRoom
      token={token}
      serverUrl={wsUrl}
      connect={true}
      onConnected={() => console.log('Connected!')}
      onDisconnected={() => console.log('Disconnected')}
    >
      <VideoConference />
    </LiveKitRoom>
  );
}
```

  </TabItem>
  <TabItem value="typescript">

```typescript title="Vanilla TypeScript"
import { Room, RoomEvent } from '@dtelecom/livekit-client';

// token and wsUrl are fetched from your server (see Getting Started guide)
async function connectToRoom(wsUrl: string, token: string) {
  const room = new Room();

  room.on(RoomEvent.Connected, () => {
    console.log('Connected to room', room.name);
  });

  room.on(RoomEvent.TrackSubscribed, (track, publication, participant) => {
    const element = track.attach();
    document.getElementById('video-container')!.appendChild(element);
  });

  await room.connect(wsUrl, token);

  // Enable camera and microphone
  await room.localParticipant.setCameraEnabled(true);
  await room.localParticipant.setMicrophoneEnabled(true);

  return room;
}
```

  </TabItem>
</Tabs>

## Leaving a room

When your client is leaving a room, you should notify dTelecom of leave events by calling `Room.disconnect()`. If the application is closed without notifying the dTelecom, it will continue to display the participant as being in the room for more than 20 seconds.

<Tabs
  defaultValue="react"
  groupId="client-sdk"
  values={[
    {label: 'React', value: 'react'},
    {label: 'Browser', value: 'typescript'},
  ]}>
  <TabItem value="react">

```tsx title="React"
// LiveKitRoom handles disconnection automatically when unmounted.
// You can also use the onDisconnected callback:
<LiveKitRoom
  token={token}
  serverUrl={wsUrl}
  connect={true}
  onDisconnected={() => {
    // Navigate back to lobby, clean up state, etc.
  }}
>
  <VideoConference />
</LiveKitRoom>
```

  </TabItem>
  <TabItem value="typescript">

```typescript title="Vanilla TypeScript"
// Disconnect from the room
room.disconnect();

// You can also listen for the disconnected event
room.on(RoomEvent.Disconnected, (reason) => {
  console.log('Disconnected:', reason);
});
```

  </TabItem>
</Tabs>

## Connectivity

dTelecom configures WebRTC to enable connectivity from a wide variety of network conditions. It'll try the following in order of preference.

1. ICE over UDP: ideal connection type, used in majority of conditions
2. TURN with UDP (443): used when firewall blocks all other UDP port other than 443
3. ICE over TCP: used when network disallows UDP (i.e. over VPN or corporate firewalls)
4. TURN with TLS: used when firewall only allows outbound TLS connections

## Network changes and reconnection

With WiFi and cellular networks, users may sometimes run into network changes that cause the connection to the server to be interrupted. This could include switching from WiFi to cellular or going through spots with poor connection.

When this happens, dTelecom will attempt to re-establish the connection behind the scenes. It'll fire off a `Reconnecting` event so your client could display additional UI to inform the user. If the reconnection is successful, you will receive a `Reconnected` callback to let you know that things are back to normal. Otherwise, it'll disconnect you from the room.

<Tabs
  defaultValue="react"
  groupId="client-sdk"
  values={[
    {label: 'React', value: 'react'},
    {label: 'Browser', value: 'typescript'},
  ]}>
  <TabItem value="react">

```tsx title="React"
import { useConnectionState } from '@dtelecom/components-react';
import { ConnectionState } from '@dtelecom/livekit-client';

function ConnectionIndicator() {
  const connectionState = useConnectionState();

  if (connectionState === ConnectionState.Reconnecting) {
    return <div>Reconnecting...</div>;
  }
  return null;
}
```

  </TabItem>
  <TabItem value="typescript">

```typescript title="Vanilla TypeScript"
room.on(RoomEvent.Reconnecting, () => {
  console.log('Reconnecting to room...');
});

room.on(RoomEvent.Reconnected, () => {
  console.log('Reconnected!');
});

room.on(RoomEvent.Disconnected, () => {
  console.log('Disconnected from room');
});
```

  </TabItem>
</Tabs>

During the reconnection, the video/audio tracks may stop sending/receiving data for a few seconds. When the connection is re-established, the tracks will then "unfreeze".

## Error handling

<Tabs
  defaultValue="react"
  groupId="client-sdk"
  values={[
    {label: 'React', value: 'react'},
    {label: 'Browser', value: 'typescript'},
  ]}>
  <TabItem value="react">

`<LiveKitRoom>` provides callbacks for error handling:

```tsx title="React"
<LiveKitRoom
  token={token}
  serverUrl={wsUrl}
  connect={true}
  audio={true}
  video={true}
  onError={(error) => {
    // Connection errors, room errors, etc.
    console.error('Room error:', error);
  }}
  onMediaDeviceFailure={(failure) => {
    // Camera or microphone access failed (permissions denied, device unavailable)
    console.error('Media device failure:', failure);
    alert('Could not access camera or microphone. Please check your browser permissions.');
  }}
  onDisconnected={() => {
    // Handle disconnection (navigate away, show reconnect UI, etc.)
  }}
>
  <VideoConference />
</LiveKitRoom>
```

| Callback | When it fires |
|:---------|:-------------|
| `onError` | Connection failures, room errors, general errors |
| `onMediaDeviceFailure` | Camera/microphone permission denied or device unavailable |
| `onDisconnected` | WebSocket connection closed (user left or network failure) |
| `onConnected` | Successfully connected to the room |

The `audio` and `video` props control whether to automatically enable the microphone and camera on join.

  </TabItem>
  <TabItem value="typescript">

```typescript title="Vanilla TypeScript"
import { Room, RoomEvent, MediaDeviceFailure } from '@dtelecom/livekit-client';

const room = new Room();

// Handle connection errors
try {
  await room.connect(wsUrl, token);
} catch (error) {
  console.error('Failed to connect:', error);
}

// Handle media device errors
room.on(RoomEvent.MediaDevicesError, (error: Error) => {
  console.error('Media device error:', error);
});

// Handle disconnection
room.on(RoomEvent.Disconnected, (reason) => {
  console.log('Disconnected:', reason);
});
```

  </TabItem>
</Tabs>
