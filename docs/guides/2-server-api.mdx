---
title: Server APIs
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

dTelecom has built-in APIs that lets you to manage rooms and moderate participants. These APIs are designed to be used by your backend.

Room APIs are built on top of [Twirp](https://twitchtv.github.io/twirp/docs/intro.html), and differ from a traditional REST interface. Arguments are passed via POSTing JSON body to the endpoints.

**Write operations** (CreateRoom, RemoveParticipant, MutePublishedTrack, UpdateParticipant, SendData, DeleteRoom) are **broadcast via P2P** across all nodes — you can call any node and the action reaches the correct target.

**Read operations** (ListRooms, ListParticipants, GetParticipant) are **local to a single node's in-memory store**. They return only what that specific node knows about. A participant connected to node A will not appear in `getParticipant()` called on node B.

## Using the Server SDK

The easiest way to interact with Room APIs is through the `RoomServiceClient` in the server SDK. Use `getApiUrl()` to discover the HTTPS endpoint automatically from the Solana node registry:

```typescript
import { AccessToken, RoomServiceClient } from '@dtelecom/server-sdk-js';

// Discover the API URL from the Solana node registry
const at = new AccessToken(process.env.API_KEY!, process.env.API_SECRET!, { identity: 'server' });
const apiUrl = await at.getApiUrl();

const client = new RoomServiceClient(
  apiUrl,
  process.env.API_KEY!,
  process.env.API_SECRET!
);
```

`getApiUrl()` queries the Solana blockchain to find the optimal node and returns an HTTPS URL (e.g. `https://node-xyz.dtel.network`). This is different from `getWsUrl()` which returns a WebSocket URL for client connections.

For most operations, you'll use the SDK methods shown below rather than calling the HTTP endpoints directly.

### Authorization header

All of the APIs require a signed access token. The token should be set in HTTP headers as

```
Authorization: Bearer <token>
```

The server SDK handles this automatically when you use `RoomServiceClient`.

### Post body

Twirp expects each request to be a HTTP POST. The body of the request should be
a JSON object (`application/json`) containing parameters specific to each request. For requests
that takes no parameters, an empty `{}` body should be used.

## APIs

### CreateRoom

Creates a new room. Requires `roomCreate` permission on the access token.

| Parameter | Type | Description |
| :-------- | :--- | :---------- |
| name | string | unique name of the room |
| emptyTimeout | number | seconds to keep the room open after the last participant leaves (default: 300) |
| maxParticipants | number | maximum number of participants allowed (0 = unlimited) |
| metadata | string | arbitrary room metadata |

```typescript
const room = await client.createRoom({
  name: 'my-room',
  emptyTimeout: 600,
  maxParticipants: 20,
  metadata: JSON.stringify({ topic: 'Team standup' }),
});
console.log('Created room:', room.name, room.sid);
```

### ListRooms

Lists active rooms. Optionally filter by room name(s). Requires `roomCreate` permission.

:::note
ListRooms is a local read — it only returns rooms hosted on the specific node your API client is connected to. It does not aggregate across the entire network.
:::

| Parameter | Type | Description |
| :-------- | :--- | :---------- |
| names | string[] | optional list of room names to filter by |

```typescript
// List all rooms
const rooms = await client.listRooms();

// List specific rooms
const rooms = await client.listRooms(['room-1', 'room-2']);
```

### DeleteRoom

Deletes an existing room by name or id. Requires `roomCreate` permission.
DeleteRoom will disconnect all participants that are currently in the room.

| Parameter | Type   | Description      |
| :-------- | :----- | :--------------- |
| room      | string | name of the room |

```typescript
await client.deleteRoom('my-room');
```

### ListParticipants

Lists participants in a room. Requires `roomAdmin` permission.

:::note
ListParticipants is a local read — it only returns participants from the node's in-memory store. Participants on other nodes will not appear.
:::

| Parameter | Type | Description |
| :-------- | :--- | :---------- |
| room | string | name of the room |

```typescript
const participants = await client.listParticipants('my-room');
for (const p of participants) {
  console.log(p.identity, p.name, p.state);
}
```

### GetParticipant

Gets information about a specific participant. Requires `roomAdmin` permission.

:::note
GetParticipant is a local read. If the participant is connected to a different node, this call will return a 404 error. Do not use it to verify a caller's identity before write operations — use the [host controls pattern](#host-controls-pattern) instead.
:::

| Parameter | Type | Description |
| :-------- | :--- | :---------- |
| room | string | name of the room |
| identity | string | identity of the participant |

```typescript
const participant = await client.getParticipant('my-room', 'user-1');
console.log(participant.name, participant.metadata);
```

### RemoveParticipant

Removes a participant from room. Requires `roomAdmin`

| Parameter | Type   | Description                 |
| :-------- | :----- | :-------------------------- |
| room      | string | name of the room            |
| identity  | string | identity of the participant |

```typescript
await client.removeParticipant('my-room', 'user-1');
```

### UpdateParticipant

Updates a participant's metadata, permissions, or display name. Requires `roomAdmin`.

| Parameter | Type | Description |
| :-------- | :--- | :---------- |
| room | string | name of the room |
| identity | string | identity of the participant |
| metadata | string | new metadata (optional) |
| permissions | object | updated permissions (optional) |
| name | string | new display name (optional) |

```typescript
await client.updateParticipant('my-room', 'user-1', {
  metadata: JSON.stringify({ role: 'presenter' }),
  name: 'New Display Name',
});
```

### UpdateRoomMetadata

Updates a room's metadata. Requires `roomAdmin`.

| Parameter | Type | Description |
| :-------- | :--- | :---------- |
| room | string | name of the room |
| metadata | string | new room metadata |

```typescript
await client.updateRoomMetadata('my-room', JSON.stringify({ recording: true }));
```

### MutePublishedTrack

Mute/unmute a participant's track. Requires `roomAdmin`

| Parameter | Type   | Description                          |
| :-------- | :----- | :----------------------------------- |
| room      | string | name of the room                     |
| identity  | string |                                      |
| track_sid | string | sid of the track to mute             |
| muted     | bool   | set to true to mute, false to unmute |

```typescript
await client.mutePublishedTrack('my-room', 'user-1', 'TR_xxxxx', true);
```

### UpdateSubscriptions

Updates a participant's track subscriptions. Requires `roomAdmin`.

| Parameter | Type | Description |
| :-------- | :--- | :---------- |
| room | string | name of the room |
| identity | string | identity of the participant |
| track_sids | string[] | track SIDs to subscribe/unsubscribe |
| subscribe | bool | true to subscribe, false to unsubscribe |

```typescript
await client.updateSubscriptions('my-room', 'user-1', ['TR_xxxxx'], true);
```

### SendData

Sends data to participants in a room. Requires `roomAdmin`.

| Parameter | Type | Description |
| :-------- | :--- | :---------- |
| room | string | name of the room |
| data | Uint8Array | payload to send |
| kind | number | 0 = RELIABLE, 1 = LOSSY |
| destination_sids | string[] | optional: specific participant SIDs (empty = broadcast) |
| topic | string | optional: topic label for the message |

```typescript
const encoder = new TextEncoder();
const data = encoder.encode(JSON.stringify({ message: 'Hello everyone!' }));

// Broadcast to all participants
await client.sendData('my-room', data, 0);

// Send to specific participants
await client.sendData('my-room', data, 0, {
  destinationSids: ['PA_xxxxx'],
  topic: 'chat',
});
```

## Host controls pattern

A common requirement is letting hosts kick or mute other participants. The pattern is:

1. **Token creation** — embed a role in participant metadata (see [Access Tokens](/guides/access-tokens#role-based-metadata-example))
2. **Frontend** — read the role from metadata to show/hide host controls; pass `callerRole` to your backend
3. **Your backend** — verify the caller's role before calling the server SDK

:::caution Why not use `getParticipant()` to verify the caller?
Because `getParticipant()` is a **local read** — it only checks the current node's in-memory store. In dTelecom's decentralized network, the caller may be connected to a different node, causing a 404 even though they are in the room. Instead, the client passes its role (set during token creation) and your backend validates it. The role was embedded in the JWT by your own server, so it is trustworthy.
:::

Here is the full flow:

### Kick endpoint

```typescript title="app/api/kick/route.ts"
import { NextRequest, NextResponse } from 'next/server';
import { getRoomService } from '@/lib/room-service';

export async function POST(req: NextRequest) {
  const { room, identity, callerRole } = await req.json();
  if (!room || !identity || !callerRole) {
    return NextResponse.json({ error: 'room, identity, and callerRole are required' }, { status: 400 });
  }

  // Verify the caller is a host (role was set in token metadata by your server)
  if (callerRole !== 'host') {
    return NextResponse.json({ error: 'Only hosts can kick participants' }, { status: 403 });
  }

  // RemoveParticipant is a write operation — it broadcasts via P2P to all nodes
  const client = await getRoomService();
  await client.removeParticipant(room, identity);
  return NextResponse.json({ success: true });
}
```

### Mute endpoint

```typescript title="app/api/mute/route.ts"
import { NextRequest, NextResponse } from 'next/server';
import { getRoomService } from '@/lib/room-service';

export async function POST(req: NextRequest) {
  const { room, identity, trackSid, callerRole } = await req.json();
  if (!room || !identity || !trackSid || !callerRole) {
    return NextResponse.json({ error: 'room, identity, trackSid, and callerRole are required' }, { status: 400 });
  }

  if (callerRole !== 'host') {
    return NextResponse.json({ error: 'Only hosts can mute participants' }, { status: 403 });
  }

  // MutePublishedTrack is a write operation — it broadcasts via P2P to all nodes
  const client = await getRoomService();
  await client.mutePublishedTrack(room, identity, trackSid, true);
  return NextResponse.json({ success: true });
}
```

### RoomService helper

```typescript title="lib/room-service.ts"
import { AccessToken, RoomServiceClient } from '@dtelecom/server-sdk-js';

let client: RoomServiceClient | null = null;
let clientPromise: Promise<RoomServiceClient> | null = null;

export async function getRoomService(): Promise<RoomServiceClient> {
  if (client) return client;
  if (clientPromise) return clientPromise;

  clientPromise = (async () => {
    const at = new AccessToken(process.env.API_KEY!, process.env.API_SECRET!, { identity: 'server' });
    const apiUrl = await at.getApiUrl();
    client = new RoomServiceClient(apiUrl, process.env.API_KEY!, process.env.API_SECRET!);
    return client;
  })();

  return clientPromise;
}
```

:::caution
Always verify the caller's role on the server. The client-side role check (from metadata) is only for UI rendering. A malicious client could call your API directly, so your backend must be the gatekeeper.
:::
